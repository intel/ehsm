

# eHSM REST API Reference

Currently, the eHSM-KMS-Service now provides the following restful APIs to the customers :


- **Cryptographic Functionalities APIs**<br>
  Notes: These below Rest APIs are used to provide crypto functionalities for users.
  - [CreateKey](#CreateKey)
  - [Encrypt](#Encrypt)
  - [Decrypt](#Decrypt)
  - [AsymmetricEncrypt](#AsymmetricEncrypt)
  - [AsymmetricDecrypt](#AsymmetricDecrypt)
  - [Sign](#Sign)
  - [Verify](#Verify)
  - [GenerateDataKey](#GenerateDataKey)
  - [GenerateDataKeyWithoutPlaintext](#GenerateDataKeyWithoutPlaintext)
  - [ExportDataKey](#ExportDataKey)

## Common Prameters
This section describes the parameters that are common to all API requests and responses.

 | Name | Type | Reference Value | Description |
 |:-----------|:-----------|:-----------|:-----------|
 | appid | string | 12345678-0123-4567-*** | An unique id to request ehsm in a domain, which is requested<br> from ehsm service maintainer |
 | timestamp | string  | 1643050812444 | The timestamp of sending request; 30 minute validity;Taking the current time as the benchmark, detect timestamp within 30 minutes, which cannot be repeated |
 |sign|string   |iw6mkXDqNipxweCH****| The signature string of the current request.<br><br>**Notes:** Before to request the ehsm-kms cryptographic APIs, the cutomer should to request the unique appid and APIKey from the ehsm kms service maintainer, and make sure they are securely stored.<br>The API key will participate in the signature, but does not participate in the parameter transfer.<br><br>*Signature= base64(HMAC-SHA256(APIKey, RequestData))*, <br>where, *RequestData=[appid=\<appid\>&payload=\<payload\>&timestamp=\<timestamp\>]* ordered in ASCII ascending, and the <payload> parameter must also be ordered.|
 |payload | Object | payload ={<br>"keyspec":"EH_RSA_3072",<br> "origin": "EH_INTERNAL_KEY"<br>} | The specific parameters of each method call.
   

## Createkey
Create a customer master key(CMK) for the user, which can be a symmetric or an asymmetric key, for the symmetric cmk mainly used to wrap the [datakey](#Generatedatakey), also can be used to encrypted an arbitrary set of bytes data(<6KB). And for the asymmetric cmk mainly used to sign/verify or asymmetric encrypt/decrypt datas(not for the datakey.)

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=CreateKey


- **Request Payload:**

   | Name | Type | Reference Value | Description |
   |:-----------|:-----------|:-----------|:-----------|
   | Keyspec | String   |  EH_AES_GCM_128 |The keyspec the user want to create, it can be the following one: <br>EH_AES_GCM_128 <br>EH_AES_GCM_256<br>EH_RSA_3072<br>EH_RSA_4096<br>EH_EC_P256<br>EH_EC_P512<br>EH_EC_SM2<br>EH_SM4<br><br>**Notes:**  currently on support the keyspec(EH_AES_GCM_128 and EH_RSA_3072), for others will support later.|
   | origin | String | EH_INTERNAL_KEY | The source about the cmk comes from, it can be:<br> EH_INTERNAL_KEY (generated from the eHSM inside)<br>EXTERNAL_KEY (generated by the customer and want to import into the eHSM)<br><br>**Notes:** currently it only support the type of EH_INTERNAL_KEY. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | cmk_base64 | String |"AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwAA***" |The result in json object for the cmk which in based64 encoding. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["keyspec"] = "EH_RSA_3072"
    paylod["origin"] = "EH_INTERNAL_KEY"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=CreateKey", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
        "code": 200,
        "message": "success!",
        "result": {
            "cmk_base64":"AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***"
        }
    }
  ```
   *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---
## Encrypt
Encrypt an arbitrary set of bytes using the CMK.(only support symmetric types).

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=Encrypt


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | aad | String | "challenge" | Some extra datas input by the user, which could help to to ensure data integrity, and not be included in the cipherblobs. |
  | cmk_base64 | String | "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***" | A symmetric cmk in BASE64 string. |
  | plaintext | String | "plaintext***" | The datas of the plaintext. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | ciphertext_base64 | String | "uSDos6NLWNVp4sQZS2+mzLvDw***" |The result in json object for the Ciphertext  which in based64 encoding. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["aad"] = "challenge"
    paylod["cmk_base64"] = "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***"
    paylod["plaintext"] = "plaintext***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=Encrypt", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "ciphertext_base64": "uSDos6NLWNVp4sQZS2+mzLvDw***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## Decrypt
Encrypt an arbitrary set of bytes using the CMK.(only support symmetric types).

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=Decrypt


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | aad | String | "challenge" | Some extra datas input by the user, which could help to to ensure data integrity, and not be included in the cipherblobs. |
  | cmk_base64 | String | "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***" | A symmetric cmk in BASE64 string. |
  | ciphertext_base64 | String | "uSDos6NLWNVp4sQZS2+mzLvDw***" | Ciphertext to be decrypted in BASE64 string. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | plaintext_base64 | String | "VGVzdDEyMzQtQU***" | Plain data after decrypt and stored in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["aad"] = "challenge"
    paylod["cmk_base64"] = "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***"
    paylod["ciphertext_base64"] = "uSDos6NLWNVp4sQZS2+mzLvDw***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=Decrypt", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "plaintext_base64": "VGVzdDEyMzQtQU***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## AsymmetricEncrypt
Encrypt an arbitrary set of bytes using the CMK.(only support asymmetric types).

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=AsymmetricEncrypt


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | cmk_base64 | String | "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***" | An asymmetric cmk in BASE64 string. |
  | plaintext | String | "plaintext***" | The datas of the plaintext. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | ciphertext_base64 | String | "EhGpx8pMYFRDr28xT4dJvrMg5***" | The data of the ciphertext stores in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["cmk_base64"] = "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***"
    paylod["plaintext"] = "plaintext***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=AsymmetricEncrypt", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "ciphertext_base64": "EhGpx8pMYFRDr28xT4dJvrMg5***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## AsymmetricDecrypt
Decrypt an arbitrary set of bytes using the CMK.(only support asymmetric types).

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=AsymmetricDecrypt


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | cmk_base64 | String | "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***" | An asymmetric cmk in BASE64 string. |
  | ciphertext_base64 | String | "EhGpx8pMYFRDr28xT4dJvrMg5***" | The data of the ciphertext in BASE64 string. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | plaintext_base64 | String | "VGVzdFJTQS0zMDcyAAAAAAAAAAAAAA***" | Plaint data after decrypt and stored in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["cmk_base64"] = "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***"
    paylod["ciphertext_base64"] = "EhGpx8pMYFRDr28xT4dJvrMg5***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=AsymmetricDecrypt", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "plaintext_base64": "VGVzdFJTQS0zMDcyAAAAAAAAAAAAAA***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## Sign
Performs sign operation using the cmk(only support asymmetric keyspec).

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=Sign


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | cmk_base64 | String | "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***" | An asymmetric cmk in BASE64 string. |
  | digest | String | "digest***" | The hash of datas want to be signed. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | signature_base64 | String | "KkUO2y2IJVdsahlUL4GA0fYf4y9wPaaocdEtfG3***" | The calculated signature value stores in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["cmk_base64"] = "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***"
    paylod["digest"] = "digest***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=Sign", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "signature_base64": "KkUO2y2IJVdsahlUL4GA0fYf4y9wPaaocdEtfG3***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## Verify
Performs verify operation using the cmk(only support asymmetric keyspec).

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=Verify


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | cmk_base64 | String | "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***" | An asymmetric cmk in BASE64 string. |
  | digest | String | "digest***" | The hash of datas want to be signed. |
  | signature_base64 | String | "KkUO2y2IJVdsahlUL4GA0fYf4y9wPaaocdEtfG3***" | The signature of the digest signed by the cmk in BASE64 string. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | result | bool | true | True or False: indicate whether the signature passed the verification. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["cmk_base64"] = "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***"
    paylod["digest"] = "digest***"
    paylod["signature_base64"] = "KkUO2y2IJVdsahlUL4GA0fYf4y9wPaaocdEtfG3***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=Verify", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "result": true
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## Generatedatakey
Generates a random data key that is used to locally encrypt data.
the DataKey will be wrapped by the specified CMK(only support asymmetric keyspec), and it will return the plaintext and ciphertext of the data key.

You can use the plaintext of the data key to locally encrypt your data without using KMS and store the encrypted data together with the ciphertext of the data key, then clear the plaintext data from memory as soon as possible.

when you want to obtain the plaintext of datakey again, you can call the Decrypt with the cmk to get the plaintext data.

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=GenerateDataKey


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | aad | String | "challenge" | Some extra datas input by the user, which could help to to ensure data integrity, and not be included in the cipherblobs. |
  | cmk_base64 | String | "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***" | A specified symmetric CMK in BASE64 string. |
  | keylen | int | 16 | Specifies the length of the plaintext, length is 0~1024 bytes. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | plaintext_base64 | String | "JzoxG7io20MgbbvVnbDhquaZ9nZtZXwRlA***" | Plain data key stores in BASE64 string. |
  | ciphertext_base64 | String | "J/qC8IwEnhsjFjzIf***" | The cipher text of the data key stores in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["aad"] = "challenge"
    paylod["cmk_base64"] = "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***"
    paylod["keylen"] = 16

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=GenerateDataKey", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "plaintext_base64": "JzoxG7io20MgbbvVnbDhquaZ9nZtZXwRlA***",
          "ciphertext_base64": "J/qC8IwEnhsjFjzIf***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## Generatedatakeywithoutplaintext
The same as GenerateDataKey, but it doesnâ€™t return plaintext of generated DataKey.

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=GenerateDataKeyWithoutPlaintext


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | aad | String | "challenge" | Some extra datas input by the user, which could help to to ensure data integrity, and not be included in the cipherblobs. |
  | cmk_base64 | String | "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***" | A specified symmetric CMK in BASE64 string. |
  | keylen | int | 16 | Specifies the length of the plaintext, length is 0~1024 bytes. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | ciphertext_base64 | String | "J/qC8IwEnhsjFjzIf***" | The cipher text of the data key stores in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["aad"] = "challenge"
    paylod["cmk_base64"] = "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***"
    paylod["keylen"] = 16

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign

    requests.post(url="<ehsm_srv_address>/ehsm?Action=GenerateDataKeyWithoutPlaintext", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "ciphertext_base64": "J/qC8IwEnhsjFjzIf***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---

## ExportDataKey
ehsm-core enclave will decrypt user-supplied ciphertextblob with specified CMK to get the plaintext of DataKey, then use the user-supplied Public key to encrypt this DataKey(aka ExportedDataKey). This ExportedDataKey (ciphertext) will be returned to caller.

- **Rest API format:**

   POST <ehsm_srv_address>/ehsm?Action=ExportDataKey


- **Request Payload:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | aad | String | "challenge" | Some extra datas input by the user, which could help to to ensure data integrity. |
  | cmk_base64 | String | "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwAA***" | A specified symmetric CMK in BASE64 string. |
  | olddatakey_base64 | String | "J/qC8IwEnhsjFjzIf***" | The ciphertext of the datakey wrapped by the cmk in BASE64 string. |
  | ukey_base64 | String | "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***" | An asymmetric use specified key in BASE64 string. |

  Notes: for the common request parameters, please refer to the [common params](#Common-Prameters)
   
- **Response Data:**

  | Name | Type | Reference Value | Description |
  |:-----------|:-----------|:-----------|:-----------|
  | code | int | 200 | The result of the method call, 200 is success, others are fail. |
  | message | String | "success" | The description of result. |
  | newdatakey_base64 | String | "a4cN1k8QcXLhxm8dUoVHbXWB4P1v/kr***" | The ciphertext of the datakey wrapped by the ukey stores in BASE64 string. |

- **Example**
	- Request sample in python
  ```python
    paylod = OrderedDict()
    paylod["aad"] = "challenge"
    paylod["cmk_base64"] = "AAAAAAAAAAAAAAAAAAAAAGCcKdP/fwA***"
    paylod["olddatakey_base64"] = "J/qC8IwEnhsjFjzIf***"
    paylod["ukey_base64"] = "AwAAAAAAAAAAJ9EXav7ngTocodwxFwPz/xWGh***"

    params = OrderedDict()
    params["appid"] = appid
    params["payload"] = urllib.parse.unquote(urllib.parse.urlencode(payload))
    params["timestamp"] = str(int(time.time() * 1000))

    sign_string = urllib.parse.unquote(urllib.parse.urlencode(params))
    sign = str(base64.b64encode(hmac.new(appkey.encode('utf-8'), sign_string.encode('utf-8'), digestmod=sha256).digest()),'utf-8').upper()

    params["payload"] = payload
    params["sign"] = sign
    
    requests.post(url="<ehsm_srv_address>/ehsm?Action=ExportDataKey", data=json.dumps(params), headers=headers)
  ```

	- Response data
  ```python
    Response= {
      "code": 200,
      "message": "success!",
      "result": {
          "newdatakey_base64": "a4cN1k8QcXLhxm8dUoVHbXWB4P1v/kr***"
      }
    }
  ```
  *(return to the [Cryptographic Functionalities APIs](#eHSM-REST-API-Reference).)*
---
